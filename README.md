# 有馬記念分析システム

TypeScriptで実装した有馬記念の馬券分析システムです。競走馬の過去戦績を収集・分析し、統計的手法と機械学習を組み合わせて勝率予測を行います。

## インストール

### ローカル環境

```bash
yarn install
yarn build
```

## 使用方法

### Claude Code での使い方（推奨）

Claude Code を使用すると、対話形式で簡単にレース予想ができます。

#### 1. データ取得
JRA出馬表のリンクがあれば予測させられます。たくさんデータを溜めているほど精度は上がります。
```
/データ取得 <JRA出馬表URL>
```

例:
```
/データ取得 https://www.jra.go.jp/JRADB/accessD.html?CNAME=pwhogehoge/A1
```

- JRAの出馬表ページからHTMLを取得
- 馬データを自動抽出（馬名、血統、騎手、オッズ、過去成績など）
- DBに保存するか確認（保存するとスコア計算・予想機能が使用可能に）

#### 2. レース予想

```
/レース一覧
```

- 登録済みレースの一覧を表示
- 予想したいレースを選択
- **スコアリング分析**: 6項目の総合評価（直近成績・コース適性・距離適性・上がり3F・G1実績・ローテ）
- **機械学習予測**: ロジスティック回帰＋ランダムフォレストで複勝確率を予測
- 両モデルを総合して最終予想を出力（◎○▲、買い目提案など）

#### 3. その他のコマンド

```
/馬一覧          # 登録済みの馬を一覧表示
/血統分析        # 種牡馬別の成績統計を表示
/コース分析      # コース別の成績分析
/スコア計算      # スコアリングのみ実行
/ヘルプ          # 使い方を表示
```

#### 予想出力例

```
🏆 最終予想（スコアリング × ML総合判断）

◎ 本命: 12番 クリオロゴールド
○ 対抗: 11番 ツルノマイハシ
▲ 単穴: 13番 シャインフォーミー

📊 スコア×ML比較表
📝 予想理由（両モデルの観点から）
💎 穴馬候補
⚠️ 懸念点
🎯 買い目提案
```

## スコアリングモデル

総合スコアは以下の6要素で算出されます：

- **直近成績スコア (25%)** - 直近5戦の成績
- **中山適性 (20%)** - 中山コースでの成績
- **距離適性 (15%)** - 2200m以上長距離での成績
- **上がり3F能力 (15%)** - レース展開での差し・追い込み能力
- **G1実績 (15%)** - G1レースでの実績
- **ローテ適性 (10%)** - 出走間隔と成績の関係

```
総合スコア = (直近成績 × 0.25) + (中山適性 × 0.20) + (距離適性 × 0.15) + 
           (上がり3F × 0.15) + (G1実績 × 0.15) + (ローテ × 0.10)
```

## 機械学習モデル

- **アルゴリズム**: ポリノミアル回帰
- **特徴量**: 直近成績、コース適性、距離適性、馬場適性、騎手勝率、人気、体重、オッズ、年齢、性別
- **予測対象**: 勝利確率、連対確率、3着内確率

## データベース構造

SQLiteを使用して以下のテーブルで管理：

- `horses` - 競走馬情報
- `jockeys` - 騎手情報
- `race_results` - レース結果
- `track_performance` - 馬場適性
- `course_performance` - コース適性
- `horse_scores` - スコア計算結果


## 注意事項

- 本システムは教育・研究目的で作成されています
- 実際の馬券購入は自己責任で行ってください
- スクレイピング機能はレート制限を設けていますが、利用規約を遵守してください
- 予測結果の正確性は保証されません

## ライセンス

MIT License