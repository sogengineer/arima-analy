# JRAデータ取得・抽出

JRAのURLからHTMLを取得し、馬データを抽出します。

## 引数

- `$ARGUMENTS`: JRA URL（出馬表ページ等）

## 実行手順

### 0. URL確認（重要）

`$ARGUMENTS` が空または未指定の場合、AskUserQuestion ツールを使ってURLを入力してもらってください：

- 質問: 「JRAの出馬表URLを入力してください」
- ヘッダー: 「URL入力」
- 選択肢:
  - 「出馬表ページ」: JRAの出馬表ページのURLを入力

ユーザーが「Other」で直接URLを入力した場合は、そのURLを使用してください。

### 1. HTML取得

```bash
npx tsx src/index.ts fetch-jra "$ARGUMENTS"
```

※ `$ARGUMENTS` が空の場合は、上記ステップ0で取得したURLを使用

### 2. データ抽出

```bash
npx tsx src/index.ts extract-html-only data/jra-page.html
```

### 3. DB保存の確認

データ抽出完了後、AskUserQuestion ツールを使って以下のように確認してください：

- 質問: 「データベースに保存しますか？」
- ヘッダー: 「DB保存」
- 選択肢:
  - 「保存する」: スコア計算・予想機能が使えるようになります
  - 「保存しない」: JSONファイルのみ保存（data/horse-extracted-data.json）

### 4. DB保存する場合

ユーザーが「保存する」を選択した場合、以下を実行：

```bash
npx tsx src/index.ts import-url data/horse-extracted-data.json
```

## DB保存のメリット

保存すると以下の機能が使えます：

| 機能 | 説明 |
|------|------|
| `/レース一覧` | 登録済みレースの予想実行 |
| スコアリング | 7項目の総合評価（直近成績・コース適性・距離適性・上がり3F・G1実績・ローテ・騎手能力） |
| 機械学習予測 | ロジスティック回帰＋ランダムフォレストで複勝確率を予測 |
| 血統分析 | 種牡馬別の成績統計 |
| 過去レース蓄積 | 前走データが他の馬の分析に活用される |

## 使用例

```
/データ取得 https://www.jra.go.jp/JRADB/accessD.html?CNAME=...
```

## 出力形式オプション

デフォルトは `detailed`（詳細表示）

- `detailed` - 全項目表示
- `summary` - 要約表示
- `csv` - CSV形式
