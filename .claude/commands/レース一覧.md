# レース一覧表示と予想実行

登録済みのレース一覧を表示し、予想したいレースを選択できます。

## 手順

### 1. レース一覧を取得

```bash
npx tsx src/index.ts score --list
```

### 2. ユーザーに質問

レース一覧を表示したら、AskUserQuestion ツールを使って以下のように質問してください：

- 質問: 「どのレースを予想しますか？」
- ヘッダー: 「レース選択」
- 選択肢: レース一覧から上位4件を選択肢として提示（ID: レース名 形式）

### 3. スコア計算実行

ユーザーが選択したレースIDに対して、スコア計算を実行：

```bash
npx tsx src/index.ts score --race <選択されたレースID>
```

### 4. 機械学習予測を実行

同じレースIDに対して、機械学習予測も実行：

```bash
npx tsx src/index.ts ml --race <選択されたレースID>
```

### 5. 総合判断（重要）

スコアリングとML予測の**両方の結果**を考慮して総合的に判断してください。

#### 判断基準

| 状況 | 判断方法 |
|------|----------|
| スコア順位とML順位が一致 | 信頼度高。そのまま本命に |
| スコア上位だがML下位 | スコアの要素を再確認。過大評価の可能性 |
| スコア下位だがML上位 | 穴馬候補として注目。前走成績が良い可能性 |
| 両方で中位 | 堅実だが爆発力に欠ける |

#### 重視すべきML特徴量

- **前走着順**: 最重要。直近の調子を反映
- **中山複勝率**: コース適性の客観指標
- **過去3走偏差値**: 安定感の指標

### 6. 予想結果の出力

以下の形式で出力してください：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🏆 最終予想（スコアリング × ML総合判断）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

◎ 本命: XX番 馬名
○ 対抗: XX番 馬名
▲ 単穴: XX番 馬名

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### スコアとMLの比較表を出力

```
📊 スコアリング × ML 比較

馬名              スコア順  ML順位  判定
--------------------------------------------------
XXXXX             1位      3位    ⚠️ 乖離
YYYYY             2位      1位    ★ ML推し
ZZZZZ             3位      2位    ✅ 一致
```

#### 予想理由（両モデルの観点から）

```
📝 予想理由

【◎ 本命 XX番 馬名】
・スコアリング観点: XXXX
・ML観点: 前走X着、過去3走偏差値XX.X
・総合判断: 両モデルで高評価 or MLが強く推奨

【○ 対抗 XX番 馬名】
・スコアリング観点: XXXX
・ML観点: XXXX
・総合判断: XXXX

【▲ 単穴 XX番 馬名】
・スコアリング観点: XXXX
・ML観点: XXXX
・総合判断: XXXX
```

#### 穴馬候補

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💎 穴馬候補
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

★ XX番 馬名
  → スコアは低いがML確率XX%と高め。前走好走が評価された

★ XX番 馬名
  → 根拠
```

#### 懸念点・リスク

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 懸念点
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【本命 XX番について】
・スコアとMLの乖離がある場合はその理由
・データ不足、未経験条件など

【モデル信頼度について】
・訓練データ数: XX件
・クロスバリデーション精度: XX%
・データが少ない場合は信頼度低下を明記
```

#### 買い目提案

```
🎯 買い目提案

・単勝: XX番（両モデル高評価）
・複勝: XX番（MLが推奨）
・馬連: XX-XX
・ワイド: XX-XX, XX-XX
・3連複: XX-XX-XX
```

## 出力順序

1. 最終予想（順位をドンと）
2. スコア×ML比較表
3. 予想理由（両モデルの観点から論理的に）
4. 穴馬候補
5. 懸念点・リスク
6. 買い目提案
